<ion-view class="story" ng-controller="StoryCtrl">
    <ion-nav-buttons side="right"> 
        <button class="button button-icon ion-android-bookmark" ng-click="popover.show($event)"></button>
    </ion-nav-buttons>
    <ion-content>
        <div id="story-header-container">
            <img ng-src={{story.imageList[0]}} alt="" id="story-header-image" />
        </div>
        <div class="story-wrapper">
            <h2>{{story.title}}</h2>
            <div class="story-categories">
                <div ng-repeat="category in story.categoryList" class="category-circle">
                    <i class="icon-art"></i>
                </div>
            </div>
            <div class="clear-float"></div>
            <span class="small-text published">{{story.published}}</span>
            <span class="small-text author"ng-repeat="author in story.author">{{author}}, </span>
            <p>{{story.introduction}}</p>
        </div>
        <!-- Media menubar -->
        <div class="button-bar">
            <a class="button button-light" ng-class="{'active': mediaType === 'images'}" ng-show="story.imageList.length > 0" ng-click="mediaType = 'images'">Bilder</a>
            <a class="button button-light" ng-class="{active: mediaType === 'video'}" ng-show="story.videoList[0]" ng-click="mediaType = 'video'">Video</a>
            <a class="button button-light" ng-class="{'active': mediaType === 'audio'}" ng-show="story.audioList[0]" ng-click="mediaType = 'audio'">Lydklipp</a>
        </div>
        <!-- Images, video or sound displayed depending on which button in the menubar is active -->
        <div class="media-content">
            <div ng-if="mediaType === 'images'">
                <div class="story-image-container" ng-repeat="image in story.imageList">
                    <img ng-src={{image}} ng-click="showImages($index)" alt="" class="image-list-thumb"/>
                </div>
            </div>
            <div ng-if="mediaType === 'video'">
                <div class="video-player" ng-repeat="videoUrl in story.videoList">
                    <!--Youtube or vimeo video-->
                    <iframe ng-if="!videoUrl.indexOf('.mp4')"frameborder="0" ng-src="{{getTrustedUrl(videoUrl)}}" ng-hide="true">
                    </iframe>
                    <!-- mp4 video -->
                    <video id="{{'Video' + $index}}" width="200" ng-if="videoUrl.indexOf('.mp4')" ng-src="{{getTrustedUrl(videoUrl)}}" ng-hide="true"></video>
                    <div class="button" id="play" ng-click="playVideo($index)"><i class="ion-play"></i></div>
                </div>
            </div>
            <div  ng-if="mediaType === 'audio'">
                <p>Navn på audiofil</p>
                <audio ng-repeat="audioUrl in story.audioList" controls preload="auto">
                    <source ng-src="{{getTrustedUrl(audioUrl)}}" />
                    Your browser does not support the audio element.
                </audio>
            </div>
        </div>
        <div class="story-wrapper">
            <p class="clear-float" ng-bind-html="story.text"></p>
        </div>

            <div class="story-footer clear-float">
            <div class="rating" ng-controller="RatingCtrl">
                <p>Likte du denne historien?</p>
                <i class="icon ion-android-star star" ng-class="{filled: i <= rating}" ng-repeat="i in [1,2,3,4,5]" ng-click="rateFunction(i)"></i>
                <button class="button button-block button-light" ng-click="notInterested()">Ikke interessert</button>
            </div>
            <h3>Eksterne ressurser</h3>
            <h3>Emneord</h3>
            <h3>Nøkkelord</h3>
            <p><a href="{{story.url}}">Les historien på Digitalt Fortalt</a></p>
        </div>
    </ion-content>
</ion-view>