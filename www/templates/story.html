<ion-view class="story" ng-controller="StoryCtrl">
    <ion-nav-buttons side="right"> 
        <button class="button button-icon ion-android-star" ng-click="showModal('templates/rating.html')"></button>
        <button class="button button-icon ion-android-bookmark" ng-click="showModal('templates/bookmark-modal.html')"></button>
    </ion-nav-buttons>
    <ion-content class="story">
        <div id="story-header-container">
            <img ng-src={{story.imageList[0]}} alt="" id="story-header-image" />
        </div>
        <div class="story-introduction card">
            <h2>{{story.title}}</h2>
            <div class="clear-float"></div>
            <span class="small-text author">{{story.author.join(", ")}}</span>
            <p>{{story.introduction}}</p>
            <div class="story-categories">
                <div ng-repeat="category in story.categoryList" class="category-circle" ng-switch on="category">
					<li class="list-cat-display" ng-switch-when="history"><i class="icon-history"></i>
					<li class="list-cat-display" ng-switch-when="nature and adventure"><i class="icon-nature"></i>
					<li class="list-cat-display" ng-switch-when="science and technology"><i class="icon-technology"></i>
					<li class="list-cat-display" ng-switch-when="art and design"><i class="icon-art"></i>
					<li class="list-cat-display" ng-switch-when="architecture"><i class="icon-architecture"></i>
					<li class="list-cat-display" ng-switch-when="local traditions and food"><i class="icon-tradition"></i>
					<li class="list-cat-display" ng-switch-when="music"><i class="ion-music-note"></i>
					<li class="list-cat-display" ng-switch-when="archeology"><i class="icon-archeology"></i>
					<li class="list-cat-display" ng-switch-when="literature"><i class="ion-ios-book"></i>
                </div>
            </div>
        </div>
        <!-- Media menubar -->
        <div class="button-bar">
            <a class="button button-light" ng-class="{active: mediaType === 'video'}" ng-show="story.videoList[0]" ng-click="mediaType = 'video'">Video</a>
            <a class="button button-light" ng-class="{'active': mediaType === 'audio'}" ng-show="story.audioList[0]" ng-click="mediaType = 'audio'">Lydklipp</a>
            <a class="button button-light" ng-class="{'active': mediaType === 'images'}" ng-show="story.imageList[0]" ng-click="mediaType = 'images'">Bilder</a>
        </div>
        <!-- Images, video or sound displayed depending on which button in the menubar is active -->
        <ion-scroll class="media-content" direction="x">
            <div ng-if="mediaType === 'images'">
                <div class="story-image-container" ng-repeat="image in story.imageList">
                    <img ng-src={{image}} ng-click="showImages($index)" alt="" class="image-list-thumb"/>
                </div>
            </div>
            <div ng-if="mediaType === 'video'">
                <div class="video-player" ng-repeat="video in story.videoList">
                    <!--Youtube or vimeo video-->
                    <iframe id="{{'Video' + $index + 'b'}}" ng-if="!video['videourl'].indexOf('.mp4')"frameborder="0" ng-src="{{getTrustedUrl(video['videourl'])}}">
                    </iframe>
                    <!-- mp4 video -->
                    <video id="{{'Video' + $index}}" controls="false" poster={{video['posterurl']}} ng-if="video['videourl'].indexOf('.mp4')" ng-src="{{getTrustedUrl(video['videourl'])}}"></video>
                    <div class="play-button" id="play" ng-click="playVideo($index)">
                        <i class="icon ion-play"></i>
                    </div>
                </div>
            </div>
            <div  ng-if="mediaType === 'audio'">
                <p>Navn på audiofil</p>
                <audio ng-repeat="audioUrl in story.audioList" controls preload="auto">
                    <source ng-src="{{getTrustedUrl(audioUrl)}}" />
                    Your browser does not support the audio element.
                </audio>
            </div>
        </ion-scroll>
        <div class="story-wrapper card">
            <p class="clear-float" ng-bind-html="story.text"></p>
        </div>

            <div class="story-footer clear-float">
            <div class="rating" ng-controller="RatingCtrl">
                <p>Likte du denne historien?</p>
                <i class="icon ion-android-star star" ng-class="{filled: i <= story.rating}" ng-repeat="i in [1,2,3,4,5]" ng-click="rateFunction(i)"></i>
                <button class="button button-block button-light" ng-click="rateFunction(0)">Ikke interessert</button>
            </div>
            <h3>Sted</h3>
            <span>{{story.municipality}}</span>
            <h3>Fylke</h3>
            <span>{{story.county}}</span>
            <h3>Institusjon</h3>
            <span>{{story.institution}}</span>
            <p><a href="#" ng-click="openUrl(story.url)">Les historien på Digitalt Fortalt</a></p>
        </div>
    </ion-content>
</ion-view>