<ion-view class="recommendations" view-title="Anbefalte fortellinger">
    <ion-nav-buttons side="right"> 
        <button class="button button-icon ion-ios-bookmarks" ng-click="showModal('templates/bookmark-modal.html')"></button>
    </ion-nav-buttons>
    <ion-content scroll="false">
       <ion-slide-box active-slide="activeSlide" id="slideBox" show-pager="false" on-slide-changed="slideChanged($index)">
            <ion-slide ng-repeat="story in storyPreviews">

                <!-- Story card. Only the current, previous and next slides content is loaded, in order to save memory -->
                <div class="card" ng-if="currentSlideIndex === storyPreviews.indexOf(story) || currentSlideIndex === storyPreviews.indexOf(story)-1 || currentSlideIndex === storyPreviews.indexOf(story)+1" >
                    <!-- Reject button -->
                    <div class="reject-story-icon" ng-click="rejectStory($index)"><i class="ion-close-round"></i></div>
                    <div class="image-wrapper" ng-click="openStory(story)">
                        <img class="cover-image" ng-src={{story.picture}}>
                        <div class="cover-image" ng-if="!story.picture"><i class="ion-image"></i></div>
                    </div>

                    <div class="content-wrapper" ng-click="openStory(story)">
                        <!-- Categories -->
                        <div class="recom-story-categories">
                            <ul ng-repeat="category in story.categories" class="recom-category-circle" ng-switch on="category">
                                <li class="list-cat-display cat-1" ng-switch-when="1"><i class="icon-art"></i></li>
                                <li class="list-cat-display cat-2" ng-switch-when="2"><i class="icon-architecture"></i></li>
                                <li class="list-cat-display cat-3" ng-switch-when="3"><i class="icon-archeology"></i></li>
                                <li class="list-cat-display cat-4" ng-switch-when="4"><i class="icon-history"></i></li>
                                <li class="list-cat-display cat-5" ng-switch-when="5"><i class="icon-tradition"></i></li>
                                <li class="list-cat-display cat-6" ng-switch-when="6"><i class="icon-nature"></i></li>
                                <li class="list-cat-display cat-7" ng-switch-when="7"><i class="ion-ios-book"></i></li>
                                <li class="list-cat-display cat-8" ng-switch-when="8"><i class="ion-music-note"></i></li>
                                <li class="list-cat-display cat-9" ng-switch-when="9"><i class="ion-gear-b"></i></li>
                            </ul>

                            <!-- Media types -->
                            <ul class="recom-category-circle media-icons">
                                <li ng-if="story.mediaType.indexOf('video') !== -1"><i class="ion-social-youtube"></i></li>
                            </ul>
                            <ul class="recom-category-circle media-icons">
                                <li ng-if="story.mediaType.indexOf('audio') !== -1"><i class="ion-volume-medium"></i></li>
                            </ul>
                            <ul class="recom-category-circle media-icons">
                                <li ng-if="story.mediaType.indexOf('picture') !== -1"><i class="ion-image"></i></li>
                            </ul>
                        </div>

                        <h2>{{story.title}}</h2>
                        <span class="small-text">{{story.author.join(", ")}}</span>
                        <p>{{story.description}}</p>

                        <div class="fade-box">
                        </div>
                    </div>
                </div>
                
                <!-- Navigation arrows -->
                <div class="slide-nav slide-nav-left" ng-click="previousSlide()" ng-hide="$index === 0" ng-if="currentSlideIndex === storyPreviews.indexOf(story) || currentSlideIndex === storyPreviews.indexOf(story)-1 || currentSlideIndex === storyPreviews.indexOf(story)+1"><i class="ion-chevron-left"></i></div>
                <div class="slide-nav slide-nav-right" ng-click="nextSlide()" ng-hide="$index === storyPreviews.length-1" ng-if="currentSlideIndex === storyPreviews.indexOf(story) || currentSlideIndex === storyPreviews.indexOf(story)-1 || currentSlideIndex === storyPreviews.indexOf(story)+1"><i class="ion-chevron-right"></i></div>

                <!-- Explanation of why the story was recommended -->
                <div class="recommExplanation" ng-if="currentSlideIndex === storyPreviews.indexOf(story) || currentSlideIndex === storyPreviews.indexOf(story)-1 || currentSlideIndex === storyPreviews.indexOf(story)+1">
                    <p ng-if="story.explanation && story.explanation[0].valueOf() !== '' && story.false_recommend == 0 && story.explanation[0].indexOf('user based') == -1">
                        Denne fortellingen ble anbefalt fordi du leste
                        <span ng-if="story.explanation.length === 1"> fortellingen <a href="#" ng-click="openStoryLink(story.explanation[0].substr(0,7))">{{story.explanation[0].substr(8) | limitTo: 40}}<span ng-if="story.explanation[0].substr(8).length > 40">...</span></a></span>
                        <span ng-if="story.explanation.length >= 2"> fortellingene <span ng-repeat="e in story.explanation"><a href="#" ng-click="openStoryLink(e.substr(0,7))">{{e.substr(8) | limitTo: 24}}<span ng-if="e.substr(8).length > 24">...</span></a><span ng-if="story.explanation.indexOf(e) !== story.explanation.length-1">, </span></span>
                    </p>
                    <p ng-if="story.explanation[0].indexOf('user based') != -1">Denne er anbefalt fordi andre som har samme interesser som deg liker den. </p>
                    <p ng-if="story.explanation[0].indexOf('item based') != -1">Denne er anbefalt fordi andre som har samme interesser som deg liker den. </p>

                    <!-- False recommendation -->
                    <p ng-if="story.false_recommend == 1">Pr√∏v den her! Denne fortellingen er valgt fordi den er annerledes fra hva du vanligvis leser.</p>
                </div>
            </ion-slide>
        </ion-slide-box>
    </ion-content>
</ion-view>